<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>DenyTube 2.0</title>

<style>
body { margin:0; background:#111; color:white; font-family:Arial; }
header {
  background:#202020; padding:10px 15px;
  display:flex; align-items:center; gap:10px;
}
#search {
  flex:1; padding:10px; border-radius:8px; border:none; outline:none;
}
#content { display:flex; height:calc(100vh - 60px); }
#sidebar {
  width:250px; background:#181818; overflow-y:auto; padding:10px;
}
#videos {
  flex:1; overflow-y:auto; padding:20px;
  display:grid; grid-template-columns:repeat(auto-fill, minmax(250px,1fr)); gap:15px;
}
.video {
  background:#1f1f1f; border-radius:10px; overflow:hidden;
  cursor:pointer; transition:.15s;
}
.video:hover { transform:scale(1.03); }
.video img { width:100%; }
.video-title { padding:10px; font-size:14px; }

#player {
  display:none; position:fixed; top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.9);
  align-items:center; justify-content:center;
}
#player iframe { width:80%; height:80%; border:none; }
#closePlayer {
  position:absolute; top:20px; right:40px;
  font-size:35px; cursor:pointer;
}

#authPanel {
  padding:10px; margin-bottom:10px;
  background:#222; border-radius:8px;
}
.profile {
  background:#222; padding:10px; border-radius:8px; margin-top:10px;
}
.comment-box { margin-top:20px; }
.comment { background:#222; padding:10px; border-radius:5px; margin-top:5px; }
.like-btn, .dislike-btn {
  cursor:pointer; margin-right:10px; font-size:20px;
}
.liked { color:#3fa9f5; }
.disliked { color:#f53f3f; }
</style>
</head>
<body>

<header>
  <h2>DenyTube</h2>
  <input id="search" type="text" placeholder="–ü–æ–∏—Å–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä Minecraft)">
</header>

<div id="content">

  <div id="sidebar">

    <div id="authPanel"></div>

    <h3>–ú–µ–Ω—é</h3>
    <p>üî• –ì–ª–∞–≤–Ω–∞—è</p>
    <p>üìà –¢—Ä–µ–Ω–¥—ã</p>
    <p>‚≠ê –õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
    <p>üë§ –ü—Ä–æ—Ñ–∏–ª—å</p>

  </div>

  <div id="videos"></div>

</div>

<div id="player">
  <div id="closePlayer">‚úñ</div>
  <iframe id="frame" allowfullscreen></iframe>

  <div class="comment-box" style="width:80%; margin:auto; max-width:800px;">
    <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
    <textarea id="commentInput" style="width:100%; height:60px;"></textarea>
    <button id="sendComment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="commentsList"></div>
  </div>

</div>

<script>
// ===== LOCAL USERS =====
let currentUser = localStorage.getItem("denytube_user");

// ===== AUTH PANEL =====
function renderAuth() {
  const box = document.getElementById("authPanel");
  if (!currentUser) {
    box.innerHTML = `
      <h3>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
      <input id="loginName" placeholder="–ò–º—è" style="width:100%; padding:5px;">
      <button onclick="login()" style="width:100%; margin-top:5px;">–í–æ–π—Ç–∏</button>
    `;
  } else {
    box.innerHTML = `<h3>–ü—Ä–∏–≤–µ—Ç, ${currentUser}</h3>
      <button onclick="logout()" style="width:100%;">–í—ã–π—Ç–∏</button>`;
  }
}

function login() {
  const name = document.getElementById("loginName").value.trim();
  if (!name) return;
  currentUser = name;
  localStorage.setItem("denytube_user", name);
  renderAuth();
}
function logout() {
  currentUser = null;
  localStorage.removeItem("denytube_user");
  renderAuth();
}

renderAuth();

// ===== YT RSS to JSON =====
async function getYoutubeRSS(keyword) {
  const rss = `https://www.youtube.com/feeds/videos.xml?search_query=${encodeURIComponent(keyword)}`;
  const url = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rss)}`;
  const r = await fetch(url);
  return await r.json();
}

// ===== MAIN LOAD =====
async function loadVideos(keyword = "news") {
  const feed = await getYoutubeRSS(keyword);
  const items = feed.items || [];
  showVideos(items);
}

function showVideos(items) {
  const container = document.getElementById("videos");
  container.innerHTML = "";

  items.forEach(v => {
    const div = document.createElement("div");
    div.className = "video";
    div.innerHTML = `
      <img src="${v.thumbnail}">
      <div class="video-title">${v.title}</div>
    `;
    div.onclick = () => openVideo(v.videoId, v.title);
    container.appendChild(div);
  });
}

// ===== VIDEO OPEN =====
let currentVideo = null;

function openVideo(id, title) {
  currentVideo = id;

  document.getElementById("player").style.display = "flex";
  document.getElementById("frame").src = `https://www.youtube.com/embed/${id}`;

  loadComments();
  loadLikes();
}

document.getElementById("closePlayer").onclick = () => {
  document.getElementById("player").style.display = "none";
  document.getElementById("frame").src = "";
};

// ===== COMMENTS =====
function loadComments() {
  const list = document.getElementById("commentsList");
  const cm = JSON.parse(localStorage.getItem("comments_" + currentVideo) || "[]");
  list.innerHTML = "";
  cm.forEach(c => {
    list.innerHTML += `<div class="comment"><b>${c.user}:</b> ${c.text}</div>`;
  });
}

document.getElementById("sendComment").onclick = () => {
  if (!currentUser) return alert("–ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è!");

  const text = document.getElementById("commentInput").value.trim();
  if (!text) return;

  const cm = JSON.parse(localStorage.getItem("comments_" + currentVideo) || "[]");
  cm.push({ user: currentUser, text });
  localStorage.setItem("comments_" + currentVideo, JSON.stringify(cm));
  document.getElementById("commentInput").value = "";
  loadComments();
};

// ===== LIKES =====
function loadLikes() {
  let l = localStorage.getItem("like_" + currentVideo);
  let d = localStorage.getItem("dislike_" + currentVideo);

  // visual
}

// ===== SEARCH =====
document.getElementById("search").addEventListener("keyup", e => {
  if (e.key === "Enter") {
    loadVideos(e.target.value);
  }
});

// ===== START =====
loadVideos("trending");

</script>
</body>
</html>
